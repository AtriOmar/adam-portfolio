<div
  class="z-50 fixed inset-0 flex justify-center items-center p-4 transition-opacity duration-300"
  [class.opacity-0]="!isVisible"
  [class.opacity-100]="isVisible"
>
  <!-- overlay -->
  <div class="fixed inset-0 bg-black/50 transition-opacity duration-300" (click)="close()"></div>
  <div
    class="w-full max-w-md max-h-[90vh] overflow-y-auto rounded-lg bg-white shadow-xl transition-all duration-300 transform"
    [class.scale-95]="!isVisible"
    [class.opacity-0]="!isVisible"
    [class.scale-100]="isVisible"
    [class.opacity-100]="isVisible"
  >
    <!-- Modal Header -->
    <div class="flex justify-between items-center p-6 border-b">
      <div>
        <h3 class="font-light text-xl tracking-wider">Book Session</h3>
        @if (selectedDate) {
        <p class="mt-1 text-gray-600 text-sm">{{ selectedDate | dateFormat }}</p>
        }
      </div>
      <button
        (click)="close()"
        class="p-2 rounded-lg hover:bg-gray-100 transition-colors"
        type="button"
        aria-label="Close modal"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="p-6">
      <!-- Success Message -->
      @if (submitSuccess) {
      <div class="mb-6 p-4 border border-green-200 rounded-lg bg-green-50">
        <p class="text-green-700 text-sm">{{ submitMessage }}</p>
      </div>
      }

      <!-- Reservation Form -->
      <form [formGroup]="reservationForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- First Name Field -->
        <div>
          <label for="firstName" class="block mb-1 font-medium text-gray-700 text-sm"
            >First Name *</label
          >
          <input
            type="text"
            id="firstName"
            formControlName="firstName"
            class="block w-full px-3 py-2 border border-gray-300 focus:border-pink-500 rounded-md focus:outline-none focus:ring-pink-500 text-sm"
            [class.border-red-300]="
              reservationForm.get('firstName')?.invalid && reservationForm.get('firstName')?.touched
            "
            placeholder="Your first name"
          />
          @if (getFieldError('firstName')) {
          <p class="mt-1 text-red-600 text-xs">{{ getFieldError('firstName') }}</p>
          }
        </div>

        <!-- Last Name Field -->
        <div>
          <label for="lastName" class="block mb-1 font-medium text-gray-700 text-sm"
            >Last Name *</label
          >
          <input
            type="text"
            id="lastName"
            formControlName="lastName"
            class="block w-full px-3 py-2 border border-gray-300 focus:border-pink-500 rounded-md focus:outline-none focus:ring-pink-500 text-sm"
            [class.border-red-300]="
              reservationForm.get('lastName')?.invalid && reservationForm.get('lastName')?.touched
            "
            placeholder="Your last name"
          />
          @if (getFieldError('lastName')) {
          <p class="mt-1 text-red-600 text-xs">{{ getFieldError('lastName') }}</p>
          }
        </div>

        <!-- Email Field -->
        <div>
          <label for="email" class="block mb-1 font-medium text-gray-700 text-sm">Email *</label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="block w-full px-3 py-2 border border-gray-300 focus:border-pink-500 rounded-md focus:outline-none focus:ring-pink-500 text-sm"
            [class.border-red-300]="
              reservationForm.get('email')?.invalid && reservationForm.get('email')?.touched
            "
            placeholder="your.email@example.com"
          />
          @if (getFieldError('email')) {
          <p class="mt-1 text-red-600 text-xs">{{ getFieldError('email') }}</p>
          }
        </div>

        <!-- Phone Field -->
        <div>
          <label for="phone" class="block mb-1 font-medium text-gray-700 text-sm">Phone *</label>
          <input
            type="tel"
            id="phone"
            formControlName="phone"
            class="block w-full px-3 py-2 border border-gray-300 focus:border-pink-500 rounded-md focus:outline-none focus:ring-pink-500 text-sm"
            [class.border-red-300]="
              reservationForm.get('phone')?.invalid && reservationForm.get('phone')?.touched
            "
            placeholder="(555) 123-4567"
          />
          @if (getFieldError('phone')) {
          <p class="mt-1 text-red-600 text-xs">{{ getFieldError('phone') }}</p>
          }
        </div>

        <!-- Service Type -->
        <div>
          <label for="serviceType" class="block mb-1 font-medium text-gray-700 text-sm"
            >Service Type *</label
          >
          <select
            id="serviceType"
            formControlName="serviceType"
            class="block w-full px-3 py-2 border border-gray-300 focus:border-pink-500 rounded-md focus:outline-none focus:ring-pink-500 text-sm"
            [class.border-red-300]="
              reservationForm.get('serviceType')?.invalid &&
              reservationForm.get('serviceType')?.touched
            "
          >
            <option value="">Select a service</option>
            <option value="portrait">Portrait Photography</option>
            <option value="wedding">Wedding Photography</option>
            <option value="event">Event Photography</option>
            <option value="headshot">Professional Headshots</option>
            <option value="family">Family Portrait</option>
            <option value="other">Other</option>
          </select>
          @if (getFieldError('serviceType')) {
          <p class="mt-1 text-red-600 text-xs">{{ getFieldError('serviceType') }}</p>
          }
        </div>

        <!-- Message Field -->
        <div>
          <label for="message" class="block mb-1 font-medium text-gray-700 text-sm"
            >Additional Message</label
          >
          <textarea
            id="message"
            formControlName="message"
            rows="4"
            class="block w-full px-3 py-2 border border-gray-300 focus:border-pink-500 rounded-md focus:outline-none focus:ring-pink-500 text-sm"
            [class.border-red-300]="
              reservationForm.get('message')?.invalid && reservationForm.get('message')?.touched
            "
            placeholder="Tell me more about what you're looking for..."
          ></textarea>
          @if (getFieldError('message')) {
          <p class="mt-1 text-red-600 text-xs">{{ getFieldError('message') }}</p>
          }
        </div>

        @if (submitMessage && !submitSuccess) {
        <div class="text-red-600 text-sm">
          {{ submitMessage }}
        </div>
        }

        <!-- Form Actions -->
        <div class="flex gap-3 pt-4">
          <button
            type="button"
            (click)="close()"
            class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 bg-white hover:bg-gray-50 font-medium text-gray-700 text-sm"
          >
            Cancel
          </button>
          <button
            type="submit"
            [disabled]="reservationForm.invalid || isSubmitting"
            class="flex-1 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 bg-pink-600 hover:bg-pink-700 disabled:opacity-50 font-medium text-white text-sm disabled:cursor-not-allowed"
          >
            @if (!isSubmitting) {
            <span>Book Session</span>
            } @if (isSubmitting) {
            <span class="flex justify-center items-center">
              <svg
                class="w-4 h-4 mr-2 animate-spin"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                ></path>
              </svg>
              Booking...
            </span>
            }
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
