<!-- RESERVATION SECTION -->
<section class="max-w-7xl mx-auto px-6 py-12">
  <!-- Title -->
  <div class="mb-10 text-center animate-fade-in">
    <h2 class="inline-block relative font-extralight text-4xl md:text-5xl tracking-widest">
      <span class="z-10 relative">BOOK A SESSION</span>
      <span
        class="-bottom-3 left-0 absolute w-full h-1 rounded-full bg-linear-to-r from-slate-400 via-zinc-400 to-gray-400 animate-pulse"
      ></span>
    </h2>
  </div>
  <p class="max-w-2xl mx-auto mb-16 text-gray-600 text-center">
    Select an available date from the calendar below to schedule your photography session. I'll
    contact you within 24 hours to confirm your booking.
  </p>

  <div class="max-w-4xl mx-auto">
    <!-- Calendar Header -->
    <div class="flex justify-between items-center mb-8">
      <button
        (click)="previousMonth()"
        class="p-2 rounded-lg hover:bg-gray-100 transition-colors"
        [disabled]="isLoading"
        [class.opacity-50]="isLoading"
        [class.cursor-not-allowed]="isLoading"
        aria-label="Previous month"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          ></path>
        </svg>
      </button>

      <h2 class="font-light text-2xl tracking-wider">
        {{ monthNames[currentMonth] }} {{ currentYear }}
      </h2>

      <button
        (click)="nextMonth()"
        class="p-2 rounded-lg hover:bg-gray-100 transition-colors"
        [disabled]="isLoading"
        [class.opacity-50]="isLoading"
        [class.cursor-not-allowed]="isLoading"
        aria-label="Next month"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          ></path>
        </svg>
      </button>
    </div>

    <!-- Calendar Grid -->
    <div class="overflow-hidden rounded-lg bg-white shadow-lg">
      <!-- Day Names Header -->
      <div class="grid grid-cols-7 border-b bg-gray-50">
        @for (dayName of dayNames; track dayName) {
        <div class="p-4 font-medium text-gray-700 text-sm text-center">
          {{ dayName }}
        </div>
        }
      </div>

      <!-- Loading Skeleton -->
      @if (isLoading) {
      <div class="grid grid-cols-7">
        @for (i of [].constructor(42); track $index) {
        <div class="relative aspect-square p-2 border-gray-200 border-r border-b bg-gray-50">
          <div class="flex justify-center items-center h-full">
            <div class="w-8 h-8 rounded bg-gray-200 animate-pulse"></div>
          </div>
        </div>
        }
      </div>
      }

      <!-- Calendar Days -->
      @if (!isLoading) {
      <div class="grid grid-cols-7">
        @for (calendarDay of calendarDays; track calendarDay.date.getTime()) {
        <div
          class="relative aspect-square p-2 border-gray-200 border-r border-b hover:bg-gray-50 transition-all cursor-pointer"
          [class]="
            !calendarDay.isCurrentMonth
              ? 'bg-gray-50 text-gray-400'
              : calendarDay.isPast
              ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
              : !calendarDay.isAvailable
              ? 'bg-red-50 text-red-400 cursor-not-allowed'
              : 'hover:bg-pink-50 hover:text-pink-600'
          "
          (click)="onDayClick(calendarDay)"
        >
          <div class="flex justify-center items-center h-full">
            <span
              class="text-lg"
              [class]="calendarDay.isAvailable && calendarDay.isCurrentMonth ? 'font-medium' : ''"
            >
              {{ calendarDay.day }}
            </span>
          </div>

          <!-- Available indicator -->
          @if (calendarDay.isAvailable && calendarDay.isCurrentMonth) {
          <div
            class="bottom-1 left-1/2 absolute w-2 h-2 rounded-full bg-green-400 -translate-x-1/2 transform"
          ></div>
          }

          <!-- Unavailable indicator -->
          @if (!calendarDay.isAvailable && calendarDay.isCurrentMonth && !calendarDay.isPast) {
          <div
            class="bottom-1 left-1/2 absolute w-2 h-2 rounded-full bg-red-400 -translate-x-1/2 transform"
          ></div>
          }
        </div>
        }
      </div>
      }
    </div>

    <!-- Legend -->
    <div class="flex justify-center gap-8 mt-6 text-sm">
      <div class="flex items-center gap-2">
        <div class="w-3 h-3 rounded-full bg-green-400"></div>
        <span class="text-gray-600">Available</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-3 h-3 rounded-full bg-red-400"></div>
        <span class="text-gray-600">Unavailable</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-3 h-3 rounded-full bg-gray-400"></div>
        <span class="text-gray-600">Past Date</span>
      </div>
    </div>
  </div>
</section>

<!-- Reservation Modal -->
@if (isModalOpen) {
<app-reservation-modal
  [selectedDate]="selectedDate"
  (closeModal)="closeModal()"
  (reservationCreated)="onReservationCreated()"
/>
}
