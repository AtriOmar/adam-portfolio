<div>
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="font-bold text-gray-900 text-2xl">Blog Management</h1>
      <p class="mt-1 text-gray-600 text-sm">Create and manage your blog posts</p>
    </div>
    <button
      (click)="createNewBlog()"
      class="px-4 py-2 rounded-md bg-pink-600 hover:bg-pink-700 font-medium text-white text-sm transition-colors"
    >
      <svg class="inline w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 4v16m8-8H4"
        ></path>
      </svg>
      New Blog Post
    </button>
  </div>

  <!-- Stats -->
  <div class="gap-6 grid grid-cols-1 md:grid-cols-3 mb-6">
    <div class="overflow-hidden rounded-lg bg-white shadow">
      <div class="p-5">
        <div class="flex items-center">
          <div class="shrink-0">
            <svg
              class="w-6 h-6 text-green-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
          </div>
          <div class="flex-1 w-0 ml-5">
            <dl>
              <dt class="font-medium text-gray-500 text-sm truncate">Published</dt>
              <dd class="font-medium text-gray-900 text-lg">{{ stats.published }}</dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="overflow-hidden rounded-lg bg-white shadow">
      <div class="p-5">
        <div class="flex items-center">
          <div class="shrink-0">
            <svg
              class="w-6 h-6 text-yellow-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
          </div>
          <div class="flex-1 w-0 ml-5">
            <dl>
              <dt class="font-medium text-gray-500 text-sm truncate">Drafts</dt>
              <dd class="font-medium text-gray-900 text-lg">{{ stats.drafts }}</dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="overflow-hidden rounded-lg bg-white shadow">
      <div class="p-5">
        <div class="flex items-center">
          <div class="shrink-0">
            <svg
              class="w-6 h-6 text-blue-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
              ></path>
            </svg>
          </div>
          <div class="flex-1 w-0 ml-5">
            <dl>
              <dt class="font-medium text-gray-500 text-sm truncate">Total Views</dt>
              <dd class="font-medium text-gray-900 text-lg">{{ stats.totalViews }}</dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Blog List -->
  <div class="rounded-lg bg-white shadow">
    <div class="sm:p-6 px-4 py-5">
      <div class="flex justify-between items-center mb-4">
        <h3 class="font-medium text-gray-900 text-lg">Recent Posts</h3>
        <div class="flex space-x-2">
          <select
            [(ngModel)]="selectedStatus"
            (change)="onStatusChange()"
            class="px-3 py-2 border border-gray-300 rounded-md text-sm"
          >
            <option value="all">All Status</option>
            <option value="published">Published</option>
            <option value="draft">Draft</option>
          </select>
          <div class="relative">
            <input
              type="text"
              placeholder="Search posts..."
              [(ngModel)]="searchQuery"
              (input)="onSearchChange()"
              class="w-64 py-2 pr-4 pl-10 border border-gray-300 rounded-md text-sm"
            />
            <svg
              class="top-2.5 left-3 absolute w-4 h-4 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
          </div>
        </div>
      </div>

      @if (loading) {
      <div class="py-12 text-center">
        <div
          class="inline-block w-8 h-8 border-pink-600 border-b-2 rounded-full animate-spin"
        ></div>
        <p class="mt-2 text-gray-500">Loading blog posts...</p>
      </div>
      } @else if (error) {
      <div class="py-12 text-center">
        <div class="mb-2 text-red-500">{{ error }}</div>
        <button
          (click)="loadBlogs()"
          class="px-4 py-2 rounded-md bg-pink-600 hover:bg-pink-700 font-medium text-white text-sm transition-colors"
        >
          Try Again
        </button>
      </div>
      } @else if (blogs.length === 0) {
      <div class="py-12 text-center">
        <svg
          class="w-16 h-16 mx-auto mb-4 text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"
          ></path>
        </svg>
        <h3 class="mb-2 font-medium text-gray-900 text-lg">No blog posts found</h3>
        <p class="mb-4 text-gray-500">Start sharing your photography stories and insights.</p>
        <button
          (click)="createNewBlog()"
          class="px-4 py-2 rounded-md bg-pink-600 hover:bg-pink-700 font-medium text-white text-sm transition-colors"
        >
          Create First Post
        </button>
      </div>
      } @else {
      <!-- Blog Posts Table -->
      <div class="overflow-hidden md:rounded-lg ring-1 ring-black ring-opacity-5 shadow">
        <table class="min-w-full divide-y divide-gray-300">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 font-medium text-gray-500 text-xs text-left uppercase tracking-wide"
              >
                Title
              </th>
              <th
                class="px-6 py-3 font-medium text-gray-500 text-xs text-left uppercase tracking-wide"
              >
                Status
              </th>
              <th
                class="px-6 py-3 font-medium text-gray-500 text-xs text-left uppercase tracking-wide"
              >
                Category
              </th>
              <th
                class="px-6 py-3 font-medium text-gray-500 text-xs text-left uppercase tracking-wide"
              >
                Views
              </th>
              <th
                class="px-6 py-3 font-medium text-gray-500 text-xs text-left uppercase tracking-wide"
              >
                Date
              </th>
              <th
                class="px-6 py-3 font-medium text-gray-500 text-xs text-right uppercase tracking-wide"
              >
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 bg-white">
            @for (blog of blogs; track blog.id) {
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  @if (blog.attributes.featuredImage?.url) {
                  <div class="w-10 h-10 shrink-0">
                    <img
                      class="w-10 h-10 object-cover rounded-full"
                      [src]="blog.attributes.featuredImage?.url"
                      [alt]="blog.attributes.featuredImage?.alt"
                    />
                  </div>
                  }
                  <div class="ml-4">
                    <div class="max-w-xs font-medium text-gray-900 text-sm truncate">
                      {{ blog.attributes.title }}
                    </div>
                    @if (blog.attributes.excerpt) {
                    <div class="max-w-xs text-gray-500 text-sm truncate">
                      {{ blog.attributes.excerpt }}
                    </div>
                    }
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="inline-flex px-2 py-1 rounded-full font-semibold text-xs"
                  [class]="getStatusBadgeClass(blog.attributes.published)"
                >
                  {{ getStatusText(blog.attributes.published) }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="inline-flex px-2 py-1 rounded-full font-semibold text-xs"
                  [class]="getCategoryBadgeClass(blog.attributes.category)"
                >
                  {{ blog.attributes.category }}
                </span>
              </td>
              <td class="px-6 py-4 text-gray-900 text-sm whitespace-nowrap">
                {{ blog.attributes.views }}
              </td>
              <td class="px-6 py-4 text-gray-500 text-sm whitespace-nowrap">
                {{ formatDate(blog.attributes.createdAt) }}
              </td>
              <td class="px-6 py-4 font-medium text-sm text-right whitespace-nowrap">
                <div class="flex justify-end space-x-2">
                  <button (click)="editBlog(blog.id)" class="text-indigo-600 hover:text-indigo-900">
                    Edit
                  </button>
                  <button (click)="deleteBlog(blog.id)" class="text-red-600 hover:text-red-900">
                    Delete
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      @if (totalPages > 1) {
      <div
        class="flex justify-between items-center mt-4 px-4 sm:px-6 py-3 border-gray-200 border-t bg-white"
      >
        <div class="sm:hidden flex flex-1 justify-between">
          <button
            [disabled]="currentPage === 1"
            (click)="onPageChange(currentPage - 1)"
            class="inline-flex relative items-center px-4 py-2 border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 font-medium text-gray-700 text-sm"
          >
            Previous
          </button>
          <button
            [disabled]="currentPage === totalPages"
            (click)="onPageChange(currentPage + 1)"
            class="inline-flex relative items-center ml-3 px-4 py-2 border border-gray-300 rounded-md bg-white hover:bg-gray-50 disabled:opacity-50 font-medium text-gray-700 text-sm"
          >
            Next
          </button>
        </div>
        <div class="hidden sm:flex sm:flex-1 sm:justify-between sm:items-center">
          <div>
            <p class="text-gray-700 text-sm">
              Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to
              {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} results
            </p>
          </div>
          <div>
            <nav
              class="inline-flex isolate -space-x-px rounded-md shadow-sm"
              aria-label="Pagination"
            >
              <button
                [disabled]="currentPage === 1"
                (click)="onPageChange(currentPage - 1)"
                class="inline-flex focus:z-20 relative items-center px-2 py-2 rounded-l-md focus:outline-offset-0 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 disabled:opacity-50 text-gray-400"
              >
                <span class="sr-only">Previous</span>
                <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
                  <path
                    fill-rule="evenodd"
                    d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
              @for (page of [].constructor(totalPages); track $index) {
              <button
                (click)="onPageChange($index + 1)"
                [class]="
                  $index + 1 === currentPage
                    ? 'relative z-10 inline-flex items-center bg-pink-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-pink-600'
                    : 'relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0'
                "
              >
                {{ $index + 1 }}
              </button>
              }
              <button
                [disabled]="currentPage === totalPages"
                (click)="onPageChange(currentPage + 1)"
                class="inline-flex focus:z-20 relative items-center px-2 py-2 rounded-r-md focus:outline-offset-0 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 disabled:opacity-50 text-gray-400"
              >
                <span class="sr-only">Next</span>
                <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
                  <path
                    fill-rule="evenodd"
                    d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
            </nav>
          </div>
        </div>
      </div>
      } }
    </div>
  </div>
</div>
